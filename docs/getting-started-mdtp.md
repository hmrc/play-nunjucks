## Getting started with Nunjucks on MDTP

These notes are written assuming you are building a typical MDTP frontend microservice - i.e. assuming that you use the 
standard platform conventions for things like route prefixes, sbt plugins etc.

Note that the [viewmodel library](https://github.com/hmrc/play-nunjucks-viewmodel) includes an `it-server` 
project which gives examples of using nunjucks and the viewmodels, which is a useful reference.

#### Include the nunjucks library and viewmodels library

https://github.com/hmrc/play-nunjucks
https://github.com/hmrc/play-nunjucks-viewmodel 

Add this to your AppDependencies / build.sbt

```sbt
// replace with play-26 if using on a Play 2.6 microservice
libraryDependencies += "uk.gov.hmrc" %% "play-nunjucks" % "x.y.z-play-27"
libraryDependencies += "uk.gov.hmrc" %% "play-nunjucks-viewmodel" % "x.y.z"
```

#### Include the `govuk-frontend` library

Add this to your AppDependencies / build.sbt

```sbt
libraryDependencies += "org.webjars.npm" % "govuk-frontend" % "3.3.0"
```

#### Configure the paths to views and libraries

Add this to your application.conf file:

```hocon
nunjucks {
  viewPaths = ["views"]
  libPaths = ["govuk-frontend"]
  noCache = false // Enable caching in Production for maximum performance, disable (set to true) in Development so templates get recompiled when changed
}
```

#### Create and configure an application.scss file

In `app/assets/stylesheets`, create an `application.scss` file which contains the following:

```scala
$govuk-assets-path: "/<name-of-my-frontend>/assets/lib/govuk-frontend/govuk/assets"

@import "lib/govuk-frontend/govuk/all"
```


In `build.sbt`, include the following in your root value:

```sbt
Concat.groups := Seq(
  "javascripts/application.js" -> group(Seq("lib/govuk-frontend/govuk/all.js"))
),
uglifyCompressOptions := Seq("unused=false", "dead-code=false"),
pipelineStages in Assets := Seq(concat, uglify)
```


#### Create your views
    
Views are treated as resources by the nunjucks library, rather than being compiled Scala code.  
So your views should live in the `conf/views` directory, not under `app/views`.
    
You can see an example of a typical “layout” file (equivalent of the “main template” in a Twirl service) in the it-server
 project in the viewmodel repo: https://github.com/hmrc/play-nunjucks-viewmodel/tree/main/it-server/conf/views/includes
 and an example of a page  in the same repo, e.g.: https://github.com/hmrc/play-nunjucks-viewmodel/blob/main/it-server/conf/views/yesNo.njk

#### Render views from a controller

Inject a `NunjucksRenderer` (from package `uk.gov.hmrc.nunjucks`) into your controller.  If your controller deals with any form elements (inputs, checkboxes etc.), also have the controller extend the NunjucksSupport trait from uk.gov.hmrc.viewmodels - this includes some Json Writes for a play Form which you’ll find useful.

A simple controller action (with the `NunjucksRenderer` being injected as “renderer”) would look something like:

```scala
def myPage: Action[AnyContent] = Action.async {
  implicit request =>
    
    val context = Json.obj(
      "foo" -> "bar"
    )
  
    renderer.render("myView.njk", context).map(Ok(_))
}
```

Passing a Json object (or anything with a Json Writes) - like the “context” above - is optional; if your page doesn’t need 
to be passed any data, you can use a render method that just takes in the name of the template (the template should exist in `conf/views`).

Examples of pages that render form elements etc. can again be seen in the it-server project in the viewmodel repo.

#### Logging configuration

Please add the following logging configuration to your logback.xml to suppress some of the noise generated by the trireme library:

```xml
  <logger name="io.apigee.trireme" level="INFO"/>
  <logger name="org.webjars" level="INFO"/>
```

